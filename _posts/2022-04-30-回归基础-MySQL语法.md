>####ä¸‡ä¸ˆé«˜æ¥¼å¹³åœ°èµ·

![](https://upload-images.jianshu.io/upload_images/6943526-ab9b2afc5aba970d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

## ä¸€ã€åŸºæœ¬æ¦‚å¿µ

### æ•°æ®åº“æœ¯è¯­

*   `æ•°æ®åº“ï¼ˆdatabaseï¼‰`Â - ä¿å­˜æœ‰ç»„ç»‡çš„æ•°æ®çš„å®¹å™¨ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªæ–‡ä»¶æˆ–ä¸€ç»„æ–‡ä»¶ï¼‰ã€‚

*   `æ•°æ®è¡¨ï¼ˆtableï¼‰`Â - æŸç§ç‰¹å®šç±»å‹æ•°æ®çš„ç»“æ„åŒ–æ¸…å•ã€‚

*   `æ¨¡å¼ï¼ˆschemaï¼‰`Â - å…³äºæ•°æ®åº“å’Œè¡¨çš„å¸ƒå±€åŠç‰¹æ€§çš„ä¿¡æ¯ã€‚æ¨¡å¼å®šä¹‰äº†æ•°æ®åœ¨è¡¨ä¸­å¦‚ä½•å­˜å‚¨ï¼ŒåŒ…å«å­˜å‚¨ä»€ä¹ˆæ ·çš„æ•°æ®ï¼Œæ•°æ®å¦‚ä½•åˆ†è§£ï¼Œå„éƒ¨åˆ†ä¿¡æ¯å¦‚ä½•å‘½åç­‰ä¿¡æ¯ã€‚æ•°æ®åº“å’Œè¡¨éƒ½æœ‰æ¨¡å¼ã€‚

*   `åˆ—ï¼ˆcolumnï¼‰`Â - è¡¨ä¸­çš„ä¸€ä¸ªå­—æ®µã€‚æ‰€æœ‰è¡¨éƒ½æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªåˆ—ç»„æˆçš„ã€‚

*   `è¡Œï¼ˆrowï¼‰`Â - è¡¨ä¸­çš„ä¸€ä¸ªè®°å½•ã€‚

*   `ä¸»é”®ï¼ˆprimary keyï¼‰`Â - ä¸€åˆ—ï¼ˆæˆ–ä¸€ç»„åˆ—ï¼‰ï¼Œå…¶å€¼èƒ½å¤Ÿå”¯ä¸€æ ‡è¯†è¡¨ä¸­æ¯ä¸€è¡Œã€‚

### SQL è¯­æ³•

> SQLï¼ˆStructured Query Language)ï¼Œæ ‡å‡† SQL ç”± ANSI æ ‡å‡†å§”å‘˜ä¼šç®¡ç†ï¼Œä»è€Œç§°ä¸º ANSI SQLã€‚
>
>å„ä¸ª DBMS éƒ½æœ‰è‡ªå·±çš„å®ç°ï¼Œå¦‚ PL/SQLã€Transact-SQL ç­‰ã€‚

#### SQL è¯­æ³•ç»“æ„

![](https://upload-images.jianshu.io/upload_images/6943526-88fd981f28869127?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

SQL è¯­æ³•ç»“æ„åŒ…æ‹¬ï¼š

*   å­å¥Â - æ˜¯è¯­å¥å’ŒæŸ¥è¯¢çš„ç»„æˆæˆåˆ†ã€‚ï¼ˆåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™äº›éƒ½æ˜¯å¯é€‰çš„ã€‚ï¼‰

*   è¡¨è¾¾å¼Â - å¯ä»¥äº§ç”Ÿä»»ä½•æ ‡é‡å€¼ï¼Œæˆ–ç”±åˆ—å’Œè¡Œçš„æ•°æ®åº“è¡¨

*   è°“è¯Â - ç»™éœ€è¦è¯„ä¼°çš„ SQL ä¸‰å€¼é€»è¾‘ï¼ˆ3VLï¼‰ï¼ˆtrue/false/unknownï¼‰æˆ–å¸ƒå°”çœŸå€¼æŒ‡å®šæ¡ä»¶ï¼Œå¹¶é™åˆ¶è¯­å¥å’ŒæŸ¥è¯¢çš„æ•ˆæœï¼Œæˆ–æ”¹å˜ç¨‹åºæµç¨‹ã€‚

*   æŸ¥è¯¢Â - åŸºäºç‰¹å®šæ¡ä»¶æ£€ç´¢æ•°æ®ã€‚è¿™æ˜¯ SQL çš„ä¸€ä¸ªé‡è¦ç»„æˆéƒ¨åˆ†ã€‚

*   è¯­å¥Â - å¯ä»¥æŒä¹…åœ°å½±å“çº²è¦å’Œæ•°æ®ï¼Œä¹Ÿå¯ä»¥æ§åˆ¶æ•°æ®åº“äº‹åŠ¡ã€ç¨‹åºæµç¨‹ã€è¿æ¥ã€ä¼šè¯æˆ–è¯Šæ–­ã€‚

#### SQL è¯­æ³•è¦ç‚¹

*   SQL è¯­å¥ä¸åŒºåˆ†å¤§å°å†™ï¼Œä½†æ˜¯æ•°æ®åº“è¡¨åã€åˆ—åå’Œå€¼æ˜¯å¦åŒºåˆ†ï¼Œä¾èµ–äºå…·ä½“çš„ DBMS ä»¥åŠé…ç½®ã€‚

ä¾‹å¦‚ï¼š`SELECT`Â ä¸Â `select`Â ã€`Select`Â æ˜¯ç›¸åŒçš„ã€‚

*   å¤šæ¡ SQL è¯­å¥å¿…é¡»ä»¥åˆ†å·ï¼ˆ;ï¼‰åˆ†éš”ã€‚

*   å¤„ç† SQL è¯­å¥æ—¶ï¼Œæ‰€æœ‰ç©ºæ ¼éƒ½è¢«å¿½ç•¥ã€‚SQL è¯­å¥å¯ä»¥å†™æˆä¸€è¡Œï¼Œä¹Ÿå¯ä»¥åˆ†å†™ä¸ºå¤šè¡Œã€‚

```
-- ä¸€è¡Œ SQL è¯­å¥
UPDATE user SET username='robot', password='robot' WHERE username = 'root';

-- å¤šè¡Œ SQL è¯­å¥
UPDATE user
SET username='robot', password='robot'
WHERE username = 'root';
```

*   SQL æ”¯æŒä¸‰ç§æ³¨é‡Š

```
## æ³¨é‡Š1
-- æ³¨é‡Š2
/* æ³¨é‡Š3 */
```

#### SQL åˆ†ç±»

#### æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆDDLï¼‰

æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆData Definition Languageï¼ŒDDLï¼‰æ˜¯ SQL è¯­è¨€é›†ä¸­è´Ÿè´£æ•°æ®ç»“æ„å®šä¹‰ä¸æ•°æ®åº“å¯¹è±¡å®šä¹‰çš„è¯­è¨€ã€‚

DDL çš„ä¸»è¦åŠŸèƒ½æ˜¯**å®šä¹‰æ•°æ®åº“å¯¹è±¡**ã€‚

DDL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯Â `CREATE`ã€`ALTER`ã€`DROP`ã€‚

#### æ•°æ®æ“çºµè¯­è¨€ï¼ˆDMLï¼‰

æ•°æ®æ“çºµè¯­è¨€ï¼ˆData Manipulation Language, DMLï¼‰æ˜¯ç”¨äºæ•°æ®åº“æ“ä½œï¼Œå¯¹æ•°æ®åº“å…¶ä¸­çš„å¯¹è±¡å’Œæ•°æ®è¿è¡Œè®¿é—®å·¥ä½œçš„ç¼–ç¨‹è¯­å¥ã€‚

DML çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯Â `INSERT`ã€`UPDATE`ã€`DELETE`

DQLæ•°æ®æŸ¥è¯¢è¯­è¨€(Data Query Language)

DQLçš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯`SELECT`

è¿™å››ä¸ªæŒ‡ä»¤åˆç§° CURDï¼Œå³å¢åˆ æ”¹æŸ¥ã€‚

#### äº‹åŠ¡æ§åˆ¶è¯­è¨€ï¼ˆTCLï¼‰

äº‹åŠ¡æ§åˆ¶è¯­è¨€ (Transaction Control Language, TCL) ç”¨äº**ç®¡ç†æ•°æ®åº“ä¸­çš„äº‹åŠ¡**ã€‚

è¿™äº›ç”¨äºç®¡ç†ç”± DML è¯­å¥æ‰€åšçš„æ›´æ”¹ã€‚å®ƒè¿˜å…è®¸å°†è¯­å¥åˆ†ç»„ä¸ºé€»è¾‘äº‹åŠ¡ã€‚

TCL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯Â `COMMIT`ã€`ROLLBACK`ã€‚

#### æ•°æ®æ§åˆ¶è¯­è¨€ï¼ˆDCLï¼‰

æ•°æ®æ§åˆ¶è¯­è¨€ (Data Control Language, DCL) æ˜¯ä¸€ç§å¯å¯¹æ•°æ®è®¿é—®æƒè¿›è¡Œæ§åˆ¶çš„æŒ‡ä»¤ï¼Œå®ƒå¯ä»¥æ§åˆ¶ç‰¹å®šç”¨æˆ·è´¦æˆ·å¯¹æ•°æ®è¡¨ã€æŸ¥çœ‹è¡¨ã€é¢„å­˜ç¨‹åºã€ç”¨æˆ·è‡ªå®šä¹‰å‡½æ•°ç­‰æ•°æ®åº“å¯¹è±¡çš„æ§åˆ¶æƒã€‚

DCL çš„æ ¸å¿ƒæŒ‡ä»¤æ˜¯Â `GRANT`ã€`REVOKE`ã€‚

DCL ä»¥**æ§åˆ¶ç”¨æˆ·çš„è®¿é—®æƒé™**ä¸ºä¸»ï¼Œå› æ­¤å…¶æŒ‡ä»¤ä½œæ³•å¹¶ä¸å¤æ‚ï¼Œå¯åˆ©ç”¨ DCL æ§åˆ¶çš„æƒé™æœ‰ï¼š`CONNECT`ã€`SELECT`ã€`INSERT`ã€`UPDATE`ã€`DELETE`ã€`EXECUTE`ã€`USAGE`ã€`REFERENCES`ã€‚

æ ¹æ®ä¸åŒçš„ DBMS ä»¥åŠä¸åŒçš„å®‰å…¨æ€§å®ä½“ï¼Œå…¶æ”¯æŒçš„æƒé™æ§åˆ¶ä¹Ÿæœ‰æ‰€ä¸åŒã€‚

ï¼ˆä»¥ä¸‹ä¸º DML è¯­å¥ç”¨æ³•ï¼‰

## äºŒã€å¢åˆ æ”¹æŸ¥

> å¢åˆ æ”¹æŸ¥ï¼Œåˆç§°ä¸º CRUDï¼Œæ•°æ®åº“åŸºæœ¬æ“ä½œä¸­çš„åŸºæœ¬æ“ä½œã€‚

### æ’å…¥æ•°æ®

> *   `INSERT INTO`Â è¯­å¥ç”¨äºå‘è¡¨ä¸­æ’å…¥æ–°è®°å½•ã€‚

**æ’å…¥å®Œæ•´çš„è¡Œ**

```
INSERT INTO user
VALUES (10, 'root', 'root', 'xxxx@163.com');
```

**æ’å…¥è¡Œçš„ä¸€éƒ¨åˆ†**

```
INSERT INTO user(username, password, email)
VALUES ('admin', 'admin', 'xxxx@163.com');
```

**æ’å…¥æŸ¥è¯¢å‡ºæ¥çš„æ•°æ®**

```
INSERT INTO user(username)
SELECT name
FROM account;
```

### æ›´æ–°æ•°æ®

> *   `UPDATE`Â è¯­å¥ç”¨äºæ›´æ–°è¡¨ä¸­çš„è®°å½•ã€‚

```
UPDATE user
SET username='robot', password='robot'
WHERE username = 'root';
```

### åˆ é™¤æ•°æ®

> *   `DELETE`Â è¯­å¥ç”¨äºåˆ é™¤è¡¨ä¸­çš„è®°å½•ã€‚
>     
>     
> *   `TRUNCATE TABLE`Â å¯ä»¥æ¸…ç©ºè¡¨ï¼Œä¹Ÿå°±æ˜¯åˆ é™¤æ‰€æœ‰è¡Œã€‚

**åˆ é™¤è¡¨ä¸­çš„æŒ‡å®šæ•°æ®**

```
DELETE FROM user
WHERE username = 'robot';
```

**æ¸…ç©ºè¡¨ä¸­çš„æ•°æ®**

```
TRUNCATE TABLE user;
```

### æŸ¥è¯¢æ•°æ®

> *   `SELECT`Â è¯­å¥ç”¨äºä»æ•°æ®åº“ä¸­æŸ¥è¯¢æ•°æ®ã€‚
>     
>     
> *   `DISTINCT`Â ç”¨äºè¿”å›å”¯ä¸€ä¸åŒçš„å€¼ã€‚å®ƒä½œç”¨äºæ‰€æœ‰åˆ—ï¼Œä¹Ÿå°±æ˜¯è¯´æ‰€æœ‰åˆ—çš„å€¼éƒ½ç›¸åŒæ‰ç®—ç›¸åŒã€‚
>     
>     
> *   `LIMIT`Â é™åˆ¶è¿”å›çš„è¡Œæ•°ã€‚å¯ä»¥æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºèµ·å§‹è¡Œï¼Œä» 0 å¼€å§‹ï¼›ç¬¬äºŒä¸ªå‚æ•°ä¸ºè¿”å›çš„æ€»è¡Œæ•°ã€‚
>     
>     
> 
> *   `ASC`Â ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰
>     
>     
> *   `DESC`Â ï¼šé™åº

**æŸ¥è¯¢å•åˆ—**

```
SELECT prod_name
FROM products;
```

**æŸ¥è¯¢å¤šåˆ—**

```
SELECT prod_id, prod_name, prod_price
FROM products;
```

**æŸ¥è¯¢æ‰€æœ‰åˆ—**

```
SELECT *
FROM products;
```

**æŸ¥è¯¢ä¸åŒçš„å€¼**

```
SELECT DISTINCT
vend_id FROM products;
```

**é™åˆ¶æŸ¥è¯¢ç»“æœ**

```
-- è¿”å›å‰ 5 è¡Œ
SELECT * FROM mytable LIMIT 5;
SELECT * FROM mytable LIMIT 0, 5;
-- è¿”å›ç¬¬ 3 ~ 5 è¡Œ
SELECT * FROM mytable LIMIT 2, 3;
```

## ä¸‰ã€å­æŸ¥è¯¢

> å­æŸ¥è¯¢æ˜¯åµŒå¥—åœ¨è¾ƒå¤§æŸ¥è¯¢ä¸­çš„ SQL æŸ¥è¯¢ã€‚å­æŸ¥è¯¢ä¹Ÿç§°ä¸º**å†…éƒ¨æŸ¥è¯¢**æˆ–**å†…éƒ¨é€‰æ‹©**ï¼Œè€ŒåŒ…å«å­æŸ¥è¯¢çš„è¯­å¥ä¹Ÿç§°ä¸º**å¤–éƒ¨æŸ¥è¯¢**æˆ–**å¤–éƒ¨é€‰æ‹©**ã€‚

*   å­æŸ¥è¯¢å¯ä»¥åµŒå¥—åœ¨ SELECTï¼ŒINSERTï¼ŒUPDATE æˆ– DELETE è¯­å¥å†…æˆ–å¦ä¸€ä¸ªå­æŸ¥è¯¢ä¸­ã€‚

*   å­æŸ¥è¯¢é€šå¸¸ä¼šåœ¨å¦ä¸€ä¸ª SELECT è¯­å¥çš„ WHERE å­å¥ä¸­æ·»åŠ ã€‚

*   æ‚¨å¯ä»¥ä½¿ç”¨æ¯”è¾ƒè¿ç®—ç¬¦ï¼Œå¦‚Â >ï¼Œ<ï¼Œæˆ–Â =ã€‚æ¯”è¾ƒè¿ç®—ç¬¦ä¹Ÿå¯ä»¥æ˜¯å¤šè¡Œè¿ç®—ç¬¦ï¼Œå¦‚ INï¼ŒANY æˆ– ALLã€‚

*   å­æŸ¥è¯¢å¿…é¡»è¢«åœ†æ‹¬å·Â ()Â æ‹¬èµ·æ¥ã€‚

*   å†…éƒ¨æŸ¥è¯¢é¦–å…ˆåœ¨å…¶çˆ¶æŸ¥è¯¢ä¹‹å‰æ‰§è¡Œï¼Œä»¥ä¾¿å¯ä»¥å°†å†…éƒ¨æŸ¥è¯¢çš„ç»“æœä¼ é€’ç»™å¤–éƒ¨æŸ¥è¯¢ã€‚æ‰§è¡Œè¿‡ç¨‹å¯ä»¥å‚è€ƒä¸‹å›¾ï¼š

    ![](https://upload-images.jianshu.io/upload_images/6943526-ea3ce621c2525d1f?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

**å­æŸ¥è¯¢çš„å­æŸ¥è¯¢**

```
SELECT cust_name, cust_contact
FROM customers
WHERE cust_id IN (SELECT cust_id
                  FROM orders
                  WHERE order_num IN (SELECT order_num
                                      FROM orderitems
                                      WHERE prod_id = 'RGAN01'));
```

### WHERE

*   WHERE å­å¥ç”¨äºè¿‡æ»¤è®°å½•ï¼Œå³ç¼©å°è®¿é—®æ•°æ®çš„èŒƒå›´ã€‚

*   WHERE åè·Ÿä¸€ä¸ªè¿”å› true æˆ– false çš„æ¡ä»¶ã€‚

*   WHERE å¯ä»¥ä¸ SELECTï¼ŒUPDATE å’Œ DELETE ä¸€èµ·ä½¿ç”¨ã€‚

*   å¯ä»¥åœ¨Â WHEREÂ å­å¥ä¸­ä½¿ç”¨çš„æ“ä½œç¬¦

| è¿ç®—ç¬¦ | æè¿° |
| --- | --- |
| = | ç­‰äº |
| <> | ä¸ç­‰äºã€‚æ³¨é‡Šï¼šåœ¨ SQL çš„ä¸€äº›ç‰ˆæœ¬ä¸­ï¼Œè¯¥æ“ä½œç¬¦å¯è¢«å†™æˆ != |
| > | å¤§äº |
| < | å°äº |
| >= | å¤§äºç­‰äº |
| <= | å°äºç­‰äº |
| BETWEEN | åœ¨æŸä¸ªèŒƒå›´å†… |
| LIKE | æœç´¢æŸç§æ¨¡å¼ |
| IN | æŒ‡å®šé’ˆå¯¹æŸä¸ªåˆ—çš„å¤šä¸ªå¯èƒ½å€¼ |

**`SELECT`Â è¯­å¥ä¸­çš„Â `WHERE`Â å­å¥**

```
SELECT * FROM Customers
WHERE cust_name = 'Kids Place';
```

**`UPDATE`Â è¯­å¥ä¸­çš„Â `WHERE`Â å­å¥**

```
UPDATE CustomersSET cust_name = 'Jack Jones'
WHERE cust_name = 'Kids Place';
```

**`DELETE`Â è¯­å¥ä¸­çš„Â `WHERE`Â å­å¥**

```
DELETE FROM Customers
WHERE cust_name = 'Kids Place';
```

### IN å’Œ BETWEEN

*   IN æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯åœ¨æŒ‡å®šçš„å‡ ä¸ªç‰¹å®šå€¼ä¸­ä»»é€‰ä¸€ä¸ªå€¼ã€‚

*   BETWEEN æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯é€‰å–ä»‹äºæŸä¸ªèŒƒå›´å†…çš„å€¼ã€‚

**IN ç¤ºä¾‹**

```
SELECT *
FROM products
WHERE vend_id IN ('DLL01', 'BRS01');
```

**BETWEEN ç¤ºä¾‹**

```
SELECT *
FROM products
WHERE prod_price BETWEEN 3 AND 5;
```

### ANDã€ORã€NOT

*   ANDã€ORã€NOT æ˜¯ç”¨äºå¯¹è¿‡æ»¤æ¡ä»¶çš„é€»è¾‘å¤„ç†æŒ‡ä»¤ã€‚

*   AND ä¼˜å…ˆçº§é«˜äº ORï¼Œä¸ºäº†æ˜ç¡®å¤„ç†é¡ºåºï¼Œå¯ä»¥ä½¿ç”¨Â ()ã€‚

*   AND æ“ä½œç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶éƒ½è¦æ»¡è¶³ã€‚

*   OR æ“ä½œç¬¦è¡¨ç¤ºå·¦å³æ¡ä»¶æ»¡è¶³ä»»æ„ä¸€ä¸ªå³å¯ã€‚

*   NOT æ“ä½œç¬¦ç”¨äºå¦å®šä¸€ä¸ªæ¡ä»¶ã€‚

**AND ç¤ºä¾‹**

```
SELECT prod_id, prod_name, prod_price
FROM products
WHERE vend_id = 'DLL01' AND prod_price <= 4;
```

**OR ç¤ºä¾‹**

```
SELECT prod_id, prod_name, prod_price
FROM products
WHERE vend_id = 'DLL01' OR vend_id = 'BRS01';
```

**NOT ç¤ºä¾‹**

```
SELECT *
FROM products
WHERE prod_price NOT BETWEEN 3 AND 5;
```

### LIKE

*   LIKE æ“ä½œç¬¦åœ¨ WHERE å­å¥ä¸­ä½¿ç”¨ï¼Œä½œç”¨æ˜¯ç¡®å®šå­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…æ¨¡å¼ã€‚

*   åªæœ‰å­—æ®µæ˜¯æ–‡æœ¬å€¼æ—¶æ‰ä½¿ç”¨ LIKEã€‚

*   LIKE æ”¯æŒä¸¤ä¸ªé€šé…ç¬¦åŒ¹é…é€‰é¡¹ï¼š%Â å’ŒÂ _ã€‚

*   ä¸è¦æ»¥ç”¨é€šé…ç¬¦ï¼Œé€šé…ç¬¦ä½äºå¼€å¤´å¤„åŒ¹é…ä¼šéå¸¸æ…¢ã€‚

*   %Â è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä»»æ„æ¬¡æ•°ã€‚

*   _Â è¡¨ç¤ºä»»ä½•å­—ç¬¦å‡ºç°ä¸€æ¬¡ã€‚

**% ç¤ºä¾‹**

```
SELECT prod_id, prod_name, prod_price
FROM products
WHERE prod_name LIKE '%bean bag%';
```

**_ ç¤ºä¾‹**

```
SELECT prod_id, prod_name, prod_price
FROM products
WHERE prod_name LIKE '__ inch teddy bear';
```

## å››ã€è¿æ¥å’Œç»„åˆ

### è¿æ¥ï¼ˆJOINï¼‰

> *   å¦‚æœä¸€ä¸ªÂ `JOIN`Â è‡³å°‘æœ‰ä¸€ä¸ªå…¬å…±å­—æ®µå¹¶ä¸”å®ƒä»¬ä¹‹é—´å­˜åœ¨å…³ç³»ï¼Œåˆ™è¯¥Â `JOIN`Â å¯ä»¥åœ¨ä¸¤ä¸ªæˆ–å¤šä¸ªè¡¨ä¸Šå·¥ä½œã€‚
>     
>     
> *   è¿æ¥ç”¨äºè¿æ¥å¤šä¸ªè¡¨ï¼Œä½¿ç”¨Â `JOIN`Â å…³é”®å­—ï¼Œå¹¶ä¸”æ¡ä»¶è¯­å¥ä½¿ç”¨Â `ON`Â è€Œä¸æ˜¯Â `WHERE`ã€‚
>     
>     
> *   `JOIN`Â ä¿æŒåŸºè¡¨ï¼ˆç»“æ„å’Œæ•°æ®ï¼‰ä¸å˜ã€‚
>     
>     
> *   `JOIN`Â æœ‰ä¸¤ç§è¿æ¥ç±»å‹ï¼šå†…è¿æ¥å’Œå¤–è¿æ¥ã€‚
>     
>     
> *   å†…è¿æ¥åˆç§°ç­‰å€¼è¿æ¥ï¼Œä½¿ç”¨ INNERÂ `JOIN`Â å…³é”®å­—ã€‚åœ¨æ²¡æœ‰æ¡ä»¶è¯­å¥çš„æƒ…å†µä¸‹è¿”å›ç¬›å¡å°”ç§¯ã€‚
>     
>     
> 
> *   è‡ªè¿æ¥å¯ä»¥çœ‹æˆå†…è¿æ¥çš„ä¸€ç§ï¼Œåªæ˜¯è¿æ¥çš„è¡¨æ˜¯è‡ªèº«è€Œå·²ã€‚
>     
>     
> 
> *   è‡ªç„¶è¿æ¥æ˜¯æŠŠåŒååˆ—é€šè¿‡ = æµ‹è¯•è¿æ¥èµ·æ¥çš„ï¼ŒåŒååˆ—å¯ä»¥æœ‰å¤šä¸ªã€‚
>     
>     
> *   å†…è¿æ¥ vs è‡ªç„¶è¿æ¥
>     
>     
> 
> *   å†…è¿æ¥æä¾›è¿æ¥çš„åˆ—ï¼Œè€Œè‡ªç„¶è¿æ¥è‡ªåŠ¨è¿æ¥æ‰€æœ‰åŒååˆ—ã€‚
>     
>     
> 
> *   å¤–è¿æ¥è¿”å›ä¸€ä¸ªè¡¨ä¸­çš„æ‰€æœ‰è¡Œï¼Œå¹¶ä¸”ä»…è¿”å›æ¥è‡ªæ¬¡è¡¨ä¸­æ»¡è¶³è¿æ¥æ¡ä»¶çš„é‚£äº›è¡Œï¼Œå³ä¸¤ä¸ªè¡¨ä¸­çš„åˆ—æ˜¯ç›¸ç­‰çš„ã€‚å¤–è¿æ¥åˆ†ä¸ºå·¦å¤–è¿æ¥ã€å³å¤–è¿æ¥ã€å…¨å¤–è¿æ¥ï¼ˆMysql ä¸æ”¯æŒï¼‰ã€‚
>     
>     
> 
> *   å·¦å¤–è¿æ¥å°±æ˜¯ä¿ç•™å·¦è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚
>     
>     
> *   å³å¤–è¿æ¥å°±æ˜¯ä¿ç•™å³è¡¨æ²¡æœ‰å…³è”çš„è¡Œã€‚
>     
>     
> 
> *   è¿æ¥ vs å­æŸ¥è¯¢
>     
>     
> 
> *   è¿æ¥å¯ä»¥æ›¿æ¢å­æŸ¥è¯¢ï¼Œå¹¶ä¸”æ¯”å­æŸ¥è¯¢çš„æ•ˆç‡ä¸€èˆ¬ä¼šæ›´å¿«ã€‚


![](https://upload-images.jianshu.io/upload_images/6943526-c591fdbd3e8ff87e?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

#### å†…è¿æ¥ï¼ˆINNER JOINï¼‰

```
SELECT vend_name, prod_name, prod_price
FROM vendors INNER JOIN products
ON vendors.vend_id = products.vend_id;
```

#### è‡ªè¿æ¥

```
SELECT c1.cust_id, c1.cust_name, c1.cust_contact
FROM customers c1, customers c2
```

#### è‡ªç„¶è¿æ¥ï¼ˆNATURAL JOINï¼‰

```
SELECT *
FROM Products
NATURAL JOIN Customers;
```

#### å·¦è¿æ¥ï¼ˆLEFT JOINï¼‰

```
SELECT customers.cust_id, orders.order_num
FROM customers
 LEFT JOIN ordersON customers.cust_id = orders.cust_id;
```

#### å³è¿æ¥ï¼ˆRIGHT JOINï¼‰

```
SELECT customers.cust_id, orders.order_num
FROM customers 
RIGHT JOIN ordersON customers.cust_id = orders.cust_id;
```

### ç»„åˆï¼ˆUNIONï¼‰

*   UNION è¿ç®—ç¬¦å°†ä¸¤ä¸ªæˆ–æ›´å¤šæŸ¥è¯¢çš„ç»“æœç»„åˆèµ·æ¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç»“æœé›†ï¼Œå…¶ä¸­åŒ…å«æ¥è‡ª UNION ä¸­å‚ä¸æŸ¥è¯¢çš„æå–è¡Œã€‚

*   UNIONÂ åŸºæœ¬è§„åˆ™

*   æ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚

*   æ¯ä¸ªæŸ¥è¯¢ä¸­æ¶‰åŠè¡¨çš„åˆ—çš„æ•°æ®ç±»å‹å¿…é¡»ç›¸åŒæˆ–å…¼å®¹ã€‚

*   é€šå¸¸è¿”å›çš„åˆ—åå–è‡ªç¬¬ä¸€ä¸ªæŸ¥è¯¢ã€‚

*   é»˜è®¤ä¼šå»é™¤ç›¸åŒè¡Œï¼Œå¦‚æœéœ€è¦ä¿ç•™ç›¸åŒè¡Œï¼Œä½¿ç”¨ UNION ALLã€‚

*   åªèƒ½åŒ…å«ä¸€ä¸ª ORDER BY å­å¥ï¼Œå¹¶ä¸”å¿…é¡»ä½äºè¯­å¥çš„æœ€åã€‚

*   åº”ç”¨åœºæ™¯

*   åœ¨ä¸€ä¸ªæŸ¥è¯¢ä¸­ä»ä¸åŒçš„è¡¨è¿”å›ç»“æ„æ•°æ®ã€‚

*   å¯¹ä¸€ä¸ªè¡¨æ‰§è¡Œå¤šä¸ªæŸ¥è¯¢ï¼ŒæŒ‰ä¸€ä¸ªæŸ¥è¯¢è¿”å›æ•°æ®ã€‚

**ç»„åˆæŸ¥è¯¢**

```
SELECT cust_name, cust_contact, cust_email
FROM customers
WHERE cust_state IN ('IL', 'IN', 'MI')
UNION
SELECT cust_name, cust_contact, cust_email
FROM customers
WHERE cust_name = 'Fun4All';
```

### JOIN vs UNION

*   JOIN vs UNION

*   JOIN ä¸­è¿æ¥è¡¨çš„åˆ—å¯èƒ½ä¸åŒï¼Œä½†åœ¨ UNION ä¸­ï¼Œæ‰€æœ‰æŸ¥è¯¢çš„åˆ—æ•°å’Œåˆ—é¡ºåºå¿…é¡»ç›¸åŒã€‚

*   UNION å°†æŸ¥è¯¢ä¹‹åçš„è¡Œæ”¾åœ¨ä¸€èµ·ï¼ˆå‚ç›´æ”¾ç½®ï¼‰ï¼Œä½† JOIN å°†æŸ¥è¯¢ä¹‹åçš„åˆ—æ”¾åœ¨ä¸€èµ·ï¼ˆæ°´å¹³æ”¾ç½®ï¼‰ï¼Œå³å®ƒæ„æˆä¸€ä¸ªç¬›å¡å°”ç§¯ã€‚

## äº”ã€å‡½æ•°

> ğŸ”” æ³¨æ„ï¼šä¸åŒæ•°æ®åº“çš„å‡½æ•°å¾€å¾€å„ä¸ç›¸åŒï¼Œå› æ­¤ä¸å¯ç§»æ¤ã€‚æœ¬èŠ‚ä¸»è¦ä»¥ Mysql çš„å‡½æ•°ä¸ºä¾‹ã€‚

### æ–‡æœ¬å¤„ç†

| å‡½æ•° | è¯´æ˜ |
| --- | --- |
| `LEFT()`ã€`RIGHT()` | å·¦è¾¹æˆ–è€…å³è¾¹çš„å­—ç¬¦ |
| `LOWER()`ã€`UPPER()` | è½¬æ¢ä¸ºå°å†™æˆ–è€…å¤§å†™ |
| `LTRIM()`ã€`RTIM()` | å»é™¤å·¦è¾¹æˆ–è€…å³è¾¹çš„ç©ºæ ¼ |
| `LENGTH()` | é•¿åº¦ |
| `SOUNDEX()` | è½¬æ¢ä¸ºè¯­éŸ³å€¼ |

å…¶ä¸­ï¼Œ SOUNDEX()Â å¯ä»¥å°†ä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºæè¿°å…¶è¯­éŸ³è¡¨ç¤ºçš„å­—æ¯æ•°å­—æ¨¡å¼ã€‚

```
SELECT *
FROM mytable
WHERE SOUNDEX(col1) = SOUNDEX('apple')
```

### æ—¥æœŸå’Œæ—¶é—´å¤„ç†

*   æ—¥æœŸæ ¼å¼ï¼š`YYYY-MM-DD`

*   æ—¶é—´æ ¼å¼ï¼š`HH:MM:SS`

| å‡½ æ•° | è¯´ æ˜ |
| --- | --- |
| `AddDate()` | å¢åŠ ä¸€ä¸ªæ—¥æœŸï¼ˆå¤©ã€å‘¨ç­‰ï¼‰ |
| `AddTime()` | å¢åŠ ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶ã€åˆ†ç­‰ï¼‰ |
| `CurDate()` | è¿”å›å½“å‰æ—¥æœŸ |
| `CurTime()` | è¿”å›å½“å‰æ—¶é—´ |
| `Date()` | è¿”å›æ—¥æœŸæ—¶é—´çš„æ—¥æœŸéƒ¨åˆ† |
| `DateDiff()` | è®¡ç®—ä¸¤ä¸ªæ—¥æœŸä¹‹å·® |
| `Date_Add()` | é«˜åº¦çµæ´»çš„æ—¥æœŸè¿ç®—å‡½æ•° |
| `Date_Format()` | è¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ—¥æœŸæˆ–æ—¶é—´ä¸² |
| `Day()` | è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¤©æ•°éƒ¨åˆ† |
| `DayOfWeek()` | å¯¹äºä¸€ä¸ªæ—¥æœŸï¼Œè¿”å›å¯¹åº”çš„æ˜ŸæœŸå‡  |
| `Hour()` | è¿”å›ä¸€ä¸ªæ—¶é—´çš„å°æ—¶éƒ¨åˆ† |
| `Minute()` | è¿”å›ä¸€ä¸ªæ—¶é—´çš„åˆ†é’Ÿéƒ¨åˆ† |
| `Month()` | è¿”å›ä¸€ä¸ªæ—¥æœŸçš„æœˆä»½éƒ¨åˆ† |
| `Now()` | è¿”å›å½“å‰æ—¥æœŸå’Œæ—¶é—´ |
| `Second()` | è¿”å›ä¸€ä¸ªæ—¶é—´çš„ç§’éƒ¨åˆ† |
| `Time()` | è¿”å›ä¸€ä¸ªæ—¥æœŸæ—¶é—´çš„æ—¶é—´éƒ¨åˆ† |
| `Year()` | è¿”å›ä¸€ä¸ªæ—¥æœŸçš„å¹´ä»½éƒ¨åˆ† |

```
mysql> SELECT NOW();
```

```
2018-4-14 20:25:11
```

### æ•°å€¼å¤„ç†

| å‡½æ•° | è¯´æ˜ |
| --- | --- |
| SIN() | æ­£å¼¦ |
| COS() | ä½™å¼¦ |
| TAN() | æ­£åˆ‡ |
| ABS() | ç»å¯¹å€¼ |
| SQRT() | å¹³æ–¹æ ¹ |
| MOD() | ä½™æ•° |
| EXP() | æŒ‡æ•° |
| PI() | åœ†å‘¨ç‡ |
| RAND() | éšæœºæ•° |

### æ±‡æ€»

| å‡½ æ•° | è¯´ æ˜ |
| --- | --- |
| `AVG()` | è¿”å›æŸåˆ—çš„å¹³å‡å€¼ |
| `COUNT()` | è¿”å›æŸåˆ—çš„è¡Œæ•° |
| `MAX()` | è¿”å›æŸåˆ—çš„æœ€å¤§å€¼ |
| `MIN()` | è¿”å›æŸåˆ—çš„æœ€å°å€¼ |
| `SUM()` | è¿”å›æŸåˆ—å€¼ä¹‹å’Œ |

`AVG()`Â ä¼šå¿½ç•¥ NULL è¡Œã€‚

ä½¿ç”¨ DISTINCT å¯ä»¥è®©æ±‡æ€»å‡½æ•°å€¼æ±‡æ€»ä¸åŒçš„å€¼ã€‚

```
SELECT AVG(DISTINCT col1) AS avg_col
FROM mytable
```

## å…­ã€æ’åºå’Œåˆ†ç»„

### ORDER BY

*   ORDER BY ç”¨äºå¯¹ç»“æœé›†è¿›è¡Œæ’åºã€‚

*   ASC ï¼šå‡åºï¼ˆé»˜è®¤ï¼‰

*   DESC ï¼šé™åº

*   å¯ä»¥æŒ‰å¤šä¸ªåˆ—è¿›è¡Œæ’åºï¼Œå¹¶ä¸”ä¸ºæ¯ä¸ªåˆ—æŒ‡å®šä¸åŒçš„æ’åºæ–¹å¼

**æŒ‡å®šå¤šä¸ªåˆ—çš„æ’åºæ–¹å‘**

```
SELECT * 
FROM products
ORDER BY prod_price DESC, prod_name ASC;
```

### GROUP BY

*   GROUP BY å­å¥å°†è®°å½•åˆ†ç»„åˆ°æ±‡æ€»è¡Œä¸­ã€‚

*   GROUP BY ä¸ºæ¯ä¸ªç»„è¿”å›ä¸€ä¸ªè®°å½•ã€‚

*   GROUP BY é€šå¸¸è¿˜æ¶‰åŠèšåˆï¼šCOUNTï¼ŒMAXï¼ŒSUMï¼ŒAVG ç­‰ã€‚

*   GROUP BY å¯ä»¥æŒ‰ä¸€åˆ—æˆ–å¤šåˆ—è¿›è¡Œåˆ†ç»„ã€‚

*   GROUP BY æŒ‰åˆ†ç»„å­—æ®µè¿›è¡Œæ’åºåï¼ŒORDER BY å¯ä»¥ä»¥æ±‡æ€»å­—æ®µæ¥è¿›è¡Œæ’åºã€‚

**åˆ†ç»„**

```
SELECT cust_name, COUNT(cust_address) AS addr_num
FROM Customers 
GROUP BY cust_name;
```

**åˆ†ç»„åæ’åº**

```
SELECT cust_name, COUNT(cust_address) AS addr_num
FROM Customers 
GROUP BY cust_name
ORDER BY cust_name DESC;
```

### HAVING

*   HAVING ç”¨äºå¯¹æ±‡æ€»çš„ GROUP BY ç»“æœè¿›è¡Œè¿‡æ»¤ã€‚

*   HAVING è¦æ±‚å­˜åœ¨ä¸€ä¸ª GROUP BY å­å¥ã€‚

*   WHERE å’Œ HAVING å¯ä»¥åœ¨ç›¸åŒçš„æŸ¥è¯¢ä¸­ã€‚

*   HAVINGÂ vsÂ WHERE

*   WHERE å’Œ HAVING éƒ½æ˜¯ç”¨äºè¿‡æ»¤ã€‚

*   HAVING é€‚ç”¨äºæ±‡æ€»çš„ç»„è®°å½•ï¼›è€Œ WHERE é€‚ç”¨äºå•ä¸ªè®°å½•ã€‚

**ä½¿ç”¨ WHERE å’Œ HAVING è¿‡æ»¤æ•°æ®**

```
SELECT cust_name, COUNT(*) AS num
FROM Customers
WHERE cust_email IS NOT NULL
GROUP BY cust_name
HAVING COUNT(*) >= 1;
```

ï¼ˆä»¥ä¸‹ä¸º DDL è¯­å¥ç”¨æ³•ï¼‰

## ä¸ƒã€æ•°æ®å®šä¹‰

> DDL çš„ä¸»è¦åŠŸèƒ½æ˜¯å®šä¹‰æ•°æ®åº“å¯¹è±¡ï¼ˆå¦‚ï¼šæ•°æ®åº“ã€æ•°æ®è¡¨ã€è§†å›¾ã€ç´¢å¼•ç­‰ï¼‰ã€‚

### æ•°æ®åº“ï¼ˆDATABASEï¼‰

#### åˆ›å»ºæ•°æ®åº“

```
CREATE DATABASE test;
```

#### åˆ é™¤æ•°æ®åº“

```
DROP DATABASE test;
```

#### é€‰æ‹©æ•°æ®åº“

```
USE test;
```

### æ•°æ®è¡¨ï¼ˆTABLEï¼‰

#### åˆ›å»ºæ•°æ®è¡¨

**æ™®é€šåˆ›å»º**

```
CREATE TABLE user (
  id int(10) unsigned NOT NULL COMMENT 'Id',
  username varchar(64) NOT NULL DEFAULT 'default' COMMENT 'ç”¨æˆ·å',
  password varchar(64) NOT NULL DEFAULT 'default' COMMENT 'å¯†ç ',
  email varchar(64) NOT NULL DEFAULT 'default' COMMENT 'é‚®ç®±'
) COMMENT='ç”¨æˆ·è¡¨';
```

**æ ¹æ®å·²æœ‰çš„è¡¨åˆ›å»ºæ–°è¡¨**

```
CREATE TABLE vip_user AS
SELECT * FROM user;
```

#### åˆ é™¤æ•°æ®è¡¨

```
DROP TABLE user;
```

#### ä¿®æ”¹æ•°æ®è¡¨

**æ·»åŠ åˆ—**

```
ALTER TABLE user
ADD age int(3);
```

**åˆ é™¤åˆ—**

```
ALTER TABLE user
DROP COLUMN age;
```

**ä¿®æ”¹åˆ—**

```
ALTER TABLE `user`
MODIFY COLUMN age tinyint;
```

**æ·»åŠ ä¸»é”®**

```
ALTER TABLE user
ADD PRIMARY KEY (id);
```

**åˆ é™¤ä¸»é”®**

```
ALTER TABLE user
DROP PRIMARY KEY;
```

### è§†å›¾ï¼ˆVIEWï¼‰

> *   å®šä¹‰
>     
>     
> 
> *   è§†å›¾æ˜¯åŸºäº SQL è¯­å¥çš„ç»“æœé›†çš„å¯è§†åŒ–çš„è¡¨ã€‚
>     
>     
> *   è§†å›¾æ˜¯è™šæ‹Ÿçš„è¡¨ï¼Œæœ¬èº«ä¸åŒ…å«æ•°æ®ï¼Œä¹Ÿå°±ä¸èƒ½å¯¹å…¶è¿›è¡Œç´¢å¼•æ“ä½œã€‚å¯¹è§†å›¾çš„æ“ä½œå’Œå¯¹æ™®é€šè¡¨çš„æ“ä½œä¸€æ ·ã€‚
>     
>     
> 
> *   ä½œç”¨
>     
>     
> 
> *   ç®€åŒ–å¤æ‚çš„ SQL æ“ä½œï¼Œæ¯”å¦‚å¤æ‚çš„è”ç»“ï¼›
>     
>     
> *   åªä½¿ç”¨å®é™…è¡¨çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼›
>     
>     
> *   é€šè¿‡åªç»™ç”¨æˆ·è®¿é—®è§†å›¾çš„æƒé™ï¼Œä¿è¯æ•°æ®çš„å®‰å…¨æ€§ï¼›
>     
>     
> *   æ›´æ”¹æ•°æ®æ ¼å¼å’Œè¡¨ç¤ºã€‚

#### åˆ›å»ºè§†å›¾

```
CREATE VIEW top_10_user_view AS
SELECT id, username
FROM user
WHERE id < 10;
```

#### åˆ é™¤è§†å›¾

```
DROP VIEW top_10_user_view;
```

### ç´¢å¼•ï¼ˆINDEXï¼‰

> *   ä½œç”¨
>     
>     
> 
> *   é€šè¿‡ç´¢å¼•å¯ä»¥æ›´åŠ å¿«é€Ÿé«˜æ•ˆåœ°æŸ¥è¯¢æ•°æ®ã€‚
>     
>     
> *   ç”¨æˆ·æ— æ³•çœ‹åˆ°ç´¢å¼•ï¼Œå®ƒä»¬åªèƒ½è¢«ç”¨æ¥åŠ é€ŸæŸ¥è¯¢ã€‚
>     
>     
> 
> *   æ³¨æ„
>     
>     
> 
> *   æ›´æ–°ä¸€ä¸ªåŒ…å«ç´¢å¼•çš„è¡¨éœ€è¦æ¯”æ›´æ–°ä¸€ä¸ªæ²¡æœ‰ç´¢å¼•çš„è¡¨èŠ±è´¹æ›´å¤šçš„æ—¶é—´ï¼Œè¿™æ˜¯ç”±äºç´¢å¼•æœ¬èº«ä¹Ÿéœ€è¦æ›´æ–°ã€‚å› æ­¤ï¼Œç†æƒ³çš„åšæ³•æ˜¯ä»…ä»…åœ¨å¸¸å¸¸è¢«æœç´¢çš„åˆ—ï¼ˆä»¥åŠè¡¨ï¼‰ä¸Šé¢åˆ›å»ºç´¢å¼•ã€‚
>     
>     
> 
> *   å”¯ä¸€ç´¢å¼•
>     
>     
> 
> *   å”¯ä¸€ç´¢å¼•è¡¨æ˜æ­¤ç´¢å¼•çš„æ¯ä¸€ä¸ªç´¢å¼•å€¼åªå¯¹åº”å”¯ä¸€çš„æ•°æ®è®°å½•ã€‚

#### åˆ›å»ºç´¢å¼•

```
CREATE INDEX user_index
ON user (id);
```

#### åˆ›å»ºå”¯ä¸€ç´¢å¼•

```
CREATE UNIQUE INDEX user_index
ON user (id);
```

#### åˆ é™¤ç´¢å¼•

```
ALTER TABLE user
DROP INDEX user_index;
```

### çº¦æŸ

> SQL çº¦æŸç”¨äºè§„å®šè¡¨ä¸­çš„æ•°æ®è§„åˆ™ã€‚

*   å¦‚æœå­˜åœ¨è¿åçº¦æŸçš„æ•°æ®è¡Œä¸ºï¼Œè¡Œä¸ºä¼šè¢«çº¦æŸç»ˆæ­¢ã€‚

*   çº¦æŸå¯ä»¥åœ¨åˆ›å»ºè¡¨æ—¶è§„å®šï¼ˆé€šè¿‡ CREATE TABLE è¯­å¥ï¼‰ï¼Œæˆ–è€…åœ¨è¡¨åˆ›å»ºä¹‹åè§„å®šï¼ˆé€šè¿‡ ALTER TABLE è¯­å¥ï¼‰ã€‚

*   çº¦æŸç±»å‹

*   NOT NULL - æŒ‡ç¤ºæŸåˆ—ä¸èƒ½å­˜å‚¨ NULL å€¼ã€‚

*   UNIQUE - ä¿è¯æŸåˆ—çš„æ¯è¡Œå¿…é¡»æœ‰å”¯ä¸€çš„å€¼ã€‚

*   PRIMARY KEY - NOT NULL å’Œ UNIQUE çš„ç»“åˆã€‚ç¡®ä¿æŸåˆ—ï¼ˆæˆ–ä¸¤ä¸ªåˆ—å¤šä¸ªåˆ—çš„ç»“åˆï¼‰æœ‰å”¯ä¸€æ ‡è¯†ï¼Œæœ‰åŠ©äºæ›´å®¹æ˜“æ›´å¿«é€Ÿåœ°æ‰¾åˆ°è¡¨ä¸­çš„ä¸€ä¸ªç‰¹å®šçš„è®°å½•ã€‚

*   FOREIGN KEY - ä¿è¯ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åŒ¹é…å¦ä¸€ä¸ªè¡¨ä¸­çš„å€¼çš„å‚ç…§å®Œæ•´æ€§ã€‚

*   CHECK - ä¿è¯åˆ—ä¸­çš„å€¼ç¬¦åˆæŒ‡å®šçš„æ¡ä»¶ã€‚

*   DEFAULT - è§„å®šæ²¡æœ‰ç»™åˆ—èµ‹å€¼æ—¶çš„é»˜è®¤å€¼ã€‚

åˆ›å»ºè¡¨æ—¶ä½¿ç”¨çº¦æŸæ¡ä»¶ï¼š

```
CREATE TABLE Users (
  Id INT(10) UNSIGNED NOT NULL AUTO_INCREMENT COMMENT 'è‡ªå¢Id',
  Username VARCHAR(64) NOT NULL UNIQUE DEFAULT 'default' COMMENT 'ç”¨æˆ·å',
  Password VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'å¯†ç ',
  Email VARCHAR(64) NOT NULL DEFAULT 'default' COMMENT 'é‚®ç®±åœ°å€',
  Enabled TINYINT(4) DEFAULT NULL COMMENT 'æ˜¯å¦æœ‰æ•ˆ',
  PRIMARY KEY (Id)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';
```

ï¼ˆä»¥ä¸‹ä¸º TCL è¯­å¥ç”¨æ³•ï¼‰

## å…«ã€äº‹åŠ¡å¤„ç†

> *   ä¸èƒ½å›é€€ SELECT è¯­å¥ï¼Œå›é€€ SELECT è¯­å¥ä¹Ÿæ²¡æ„ä¹‰ï¼›ä¹Ÿä¸èƒ½å›é€€ CREATE å’Œ DROP è¯­å¥ã€‚
>     
>     
> *   MySQL é»˜è®¤æ˜¯éšå¼æäº¤ï¼Œæ¯æ‰§è¡Œä¸€æ¡è¯­å¥å°±æŠŠè¿™æ¡è¯­å¥å½“æˆä¸€ä¸ªäº‹åŠ¡ç„¶åè¿›è¡Œæäº¤ã€‚å½“å‡ºç°Â `START TRANSACTION`Â è¯­å¥æ—¶ï¼Œä¼šå…³é—­éšå¼æäº¤ï¼›å½“Â `COMMIT`Â æˆ–Â `ROLLBACK`Â è¯­å¥æ‰§è¡Œåï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å…³é—­ï¼Œé‡æ–°æ¢å¤éšå¼æäº¤ã€‚
>     
>     
> *   é€šè¿‡Â `set autocommit=0`Â å¯ä»¥å–æ¶ˆè‡ªåŠ¨æäº¤ï¼Œç›´åˆ°Â `set autocommit=1`Â æ‰ä¼šæäº¤ï¼›autocommit æ ‡è®°æ˜¯é’ˆå¯¹æ¯ä¸ªè¿æ¥è€Œä¸æ˜¯é’ˆå¯¹æœåŠ¡å™¨çš„ã€‚
>     
>     
> *   æŒ‡ä»¤
>     
>     
> 
> *   `START TRANSACTION`Â - æŒ‡ä»¤ç”¨äºæ ‡è®°äº‹åŠ¡çš„èµ·å§‹ç‚¹ã€‚
>     
>     
> *   `SAVEPOINT`Â - æŒ‡ä»¤ç”¨äºåˆ›å»ºä¿ç•™ç‚¹ã€‚
>     
>     
> *   `ROLLBACK TO`Â - æŒ‡ä»¤ç”¨äºå›æ»šåˆ°æŒ‡å®šçš„ä¿ç•™ç‚¹ï¼›å¦‚æœæ²¡æœ‰è®¾ç½®ä¿ç•™ç‚¹ï¼Œåˆ™å›é€€åˆ°Â `START TRANSACTION`Â è¯­å¥å¤„ã€‚
>     
>     
> *   `COMMIT`Â - æäº¤äº‹åŠ¡ã€‚

```
-- å¼€å§‹äº‹åŠ¡
START TRANSACTION;

-- æ’å…¥æ“ä½œ AINSERT INTO `user`
VALUES (1, 'root1', 'root1', 'xxxx@163.com');

-- åˆ›å»ºä¿ç•™ç‚¹ updateA
SAVEPOINT updateA;

-- æ’å…¥æ“ä½œ B
INSERT INTO `user`
VALUES (2, 'root2', 'root2', 'xxxx@163.com');

-- å›æ»šåˆ°ä¿ç•™ç‚¹ updateA
ROLLBACK TO updateA;

-- æäº¤äº‹åŠ¡ï¼Œåªæœ‰æ“ä½œ A ç”Ÿæ•ˆ
COMMIT;
```

ï¼ˆä»¥ä¸‹ä¸º DCL è¯­å¥ç”¨æ³•ï¼‰

## ä¹ã€æƒé™æ§åˆ¶

> *   GRANT å’Œ REVOKE å¯åœ¨å‡ ä¸ªå±‚æ¬¡ä¸Šæ§åˆ¶è®¿é—®æƒé™ï¼š
>     
>     
> 
> *   æ•´ä¸ªæœåŠ¡å™¨ï¼Œä½¿ç”¨ GRANT ALL å’Œ REVOKE ALLï¼›
>     
>     
> *   æ•´ä¸ªæ•°æ®åº“ï¼Œä½¿ç”¨ ON database.*ï¼›
>     
>     
> *   ç‰¹å®šçš„è¡¨ï¼Œä½¿ç”¨ ON database.tableï¼›
>     
>     
> *   ç‰¹å®šçš„åˆ—ï¼›
>     
>     
> *   ç‰¹å®šçš„å­˜å‚¨è¿‡ç¨‹ã€‚
>     
>     
> 
> *   æ–°åˆ›å»ºçš„è´¦æˆ·æ²¡æœ‰ä»»ä½•æƒé™ã€‚
>     
>     
> *   è´¦æˆ·ç”¨ username@host çš„å½¢å¼å®šä¹‰ï¼Œusername@% ä½¿ç”¨çš„æ˜¯é»˜è®¤ä¸»æœºåã€‚
>     
>     
> *   MySQL çš„è´¦æˆ·ä¿¡æ¯ä¿å­˜åœ¨ mysql è¿™ä¸ªæ•°æ®åº“ä¸­ã€‚
>     
>     
>     
>     ```
>     USE mysql;SELECT user FROM user;å¤åˆ¶ä»£ç 
>     ```

### åˆ›å»ºè´¦æˆ·

```
CREATE USER myuser IDENTIFIED BY 'mypassword';
```

### ä¿®æ”¹è´¦æˆ·å

```
UPDATE user SET user='newuser' WHERE user='myuser';FLUSH PRIVILEGES;
```

### åˆ é™¤è´¦æˆ·

```
DROP USER myuser;
```

### æŸ¥çœ‹æƒé™

```
SHOW GRANTS FOR myuser;
```

### æˆäºˆæƒé™

```
GRANT SELECT, INSERT ON *.* TO myuser;
```

### åˆ é™¤æƒé™

```
REVOKE SELECT, INSERT ON *.* FROM myuser;
```

### æ›´æ”¹å¯†ç 

```
SET PASSWORD FOR myuser = 'mypass';
```

## åã€å­˜å‚¨è¿‡ç¨‹

> *   å­˜å‚¨è¿‡ç¨‹å¯ä»¥çœ‹æˆæ˜¯å¯¹ä¸€ç³»åˆ— SQL æ“ä½œçš„æ‰¹å¤„ç†ï¼›
>     
>     
> *   ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹çš„å¥½å¤„
>     
>     
> 
> *   ä»£ç å°è£…ï¼Œä¿è¯äº†ä¸€å®šçš„å®‰å…¨æ€§ï¼›
>     
>     
> *   ä»£ç å¤ç”¨ï¼›
>     
>     
> *   ç”±äºæ˜¯é¢„å…ˆç¼–è¯‘ï¼Œå› æ­¤å…·æœ‰å¾ˆé«˜çš„æ€§èƒ½ã€‚
>     
>     
> 
> *   åˆ›å»ºå­˜å‚¨è¿‡ç¨‹
>     
>     
> 
> *   å‘½ä»¤è¡Œä¸­åˆ›å»ºå­˜å‚¨è¿‡ç¨‹éœ€è¦è‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œå› ä¸ºå‘½ä»¤è¡Œæ˜¯ä»¥Â `;`Â ä¸ºç»“æŸç¬¦ï¼Œè€Œå­˜å‚¨è¿‡ç¨‹ä¸­ä¹ŸåŒ…å«äº†åˆ†å·ï¼Œå› æ­¤ä¼šé”™è¯¯æŠŠè¿™éƒ¨åˆ†åˆ†å·å½“æˆæ˜¯ç»“æŸç¬¦ï¼Œé€ æˆè¯­æ³•é”™è¯¯ã€‚
>     
>     
> *   åŒ…å« inã€out å’Œ inout ä¸‰ç§å‚æ•°ã€‚
>     
>     
> *   ç»™å˜é‡èµ‹å€¼éƒ½éœ€è¦ç”¨ select into è¯­å¥ã€‚
>     
>     
> *   æ¯æ¬¡åªèƒ½ç»™ä¸€ä¸ªå˜é‡èµ‹å€¼ï¼Œä¸æ”¯æŒé›†åˆçš„æ“ä½œã€‚

### åˆ›å»ºå­˜å‚¨è¿‡ç¨‹

```
DROP PROCEDURE IF EXISTS `proc_adder`;
DELIMITER ;;
CREATE DEFINER=`root`@`localhost` PROCEDURE `proc_adder`(IN a int, IN b int, OUT sum int)
BEGIN
    DECLARE c int;
    if a is null then set a = 0;
    end if;

    if b is null then set b = 0;
    end if;

    set sum  = a + b;
END
;;
DELIMITER ;
```

### ä½¿ç”¨å­˜å‚¨è¿‡ç¨‹

```
set @b=5;call proc_adder(2,@b,@s);select @s as sum;
```

## åä¸€ã€æ¸¸æ ‡

> *   æ¸¸æ ‡ï¼ˆcursorï¼‰æ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨ DBMS æœåŠ¡å™¨ä¸Šçš„æ•°æ®åº“æŸ¥è¯¢ï¼Œå®ƒä¸æ˜¯ä¸€æ¡ SELECT è¯­å¥ï¼Œè€Œæ˜¯è¢«è¯¥è¯­å¥æ£€ç´¢å‡ºæ¥çš„ç»“æœé›†ã€‚
>     
>     
> *   åœ¨å­˜å‚¨è¿‡ç¨‹ä¸­ä½¿ç”¨æ¸¸æ ‡å¯ä»¥å¯¹ä¸€ä¸ªç»“æœé›†è¿›è¡Œç§»åŠ¨éå†ã€‚
>     
>     
> *   æ¸¸æ ‡ä¸»è¦ç”¨äºäº¤äº’å¼åº”ç”¨ï¼Œå…¶ä¸­ç”¨æˆ·éœ€è¦å¯¹æ•°æ®é›†ä¸­çš„ä»»æ„è¡Œè¿›è¡Œæµè§ˆå’Œä¿®æ”¹ã€‚
>     
>     
> *   ä½¿ç”¨æ¸¸æ ‡çš„å››ä¸ªæ­¥éª¤ï¼š
>     
>     
> 
> *   å£°æ˜æ¸¸æ ‡ï¼Œè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰å®é™…æ£€ç´¢å‡ºæ•°æ®ï¼›
>     
>     
> *   æ‰“å¼€æ¸¸æ ‡ï¼›
>     
>     
> *   å–å‡ºæ•°æ®ï¼›
>     
>     
> *   å…³é—­æ¸¸æ ‡ï¼›

```
DELIMITER $
CREATE  PROCEDURE getTotal()
BEGIN
    DECLARE total INT;
    -- åˆ›å»ºæ¥æ”¶æ¸¸æ ‡æ•°æ®çš„å˜é‡
    DECLARE sid INT;
    DECLARE sname VARCHAR(10);
    -- åˆ›å»ºæ€»æ•°å˜é‡
    DECLARE sage INT;
    -- åˆ›å»ºç»“æŸæ ‡å¿—å˜é‡    DECLARE done INT DEFAULT false;
    -- åˆ›å»ºæ¸¸æ ‡
    DECLARE cur CURSOR FOR SELECT id,name,age from cursor_table where age>30;
    -- æŒ‡å®šæ¸¸æ ‡å¾ªç¯ç»“æŸæ—¶çš„è¿”å›å€¼
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = true;
    SET total = 0;
    OPEN cur;
    FETCH cur INTO sid, sname, sage;
    WHILE(NOT done)
    DO
        SET total = total + 1;
        FETCH cur INTO sid, sname, sage;
    END WHILE;

    CLOSE cur;
    SELECT total;
END $
DELIMITER ;

-- è°ƒç”¨å­˜å‚¨è¿‡ç¨‹
call getTotal();
```

## åäºŒã€è§¦å‘å™¨

> è§¦å‘å™¨æ˜¯ä¸€ç§ä¸è¡¨æ“ä½œæœ‰å…³çš„æ•°æ®åº“å¯¹è±¡ï¼Œå½“è§¦å‘å™¨æ‰€åœ¨è¡¨ä¸Šå‡ºç°æŒ‡å®šäº‹ä»¶æ—¶ï¼Œå°†è°ƒç”¨è¯¥å¯¹è±¡ï¼Œå³è¡¨çš„æ“ä½œäº‹ä»¶è§¦å‘è¡¨ä¸Šçš„è§¦å‘å™¨çš„æ‰§è¡Œã€‚

å¯ä»¥ä½¿ç”¨è§¦å‘å™¨æ¥è¿›è¡Œå®¡è®¡è·Ÿè¸ªï¼ŒæŠŠä¿®æ”¹è®°å½•åˆ°å¦å¤–ä¸€å¼ è¡¨ä¸­ã€‚

MySQL ä¸å…è®¸åœ¨è§¦å‘å™¨ä¸­ä½¿ç”¨ CALL è¯­å¥ ï¼Œä¹Ÿå°±æ˜¯ä¸èƒ½è°ƒç”¨å­˜å‚¨è¿‡ç¨‹ã€‚

**`BEGIN`Â å’ŒÂ `END`**

å½“è§¦å‘å™¨çš„è§¦å‘æ¡ä»¶æ»¡è¶³æ—¶ï¼Œå°†ä¼šæ‰§è¡ŒÂ `BEGIN`Â å’ŒÂ `END`Â ä¹‹é—´çš„è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œã€‚

> ğŸ””Â æ³¨æ„ï¼šåœ¨ MySQL ä¸­ï¼Œåˆ†å·Â `;`Â æ˜¯è¯­å¥ç»“æŸçš„æ ‡è¯†ç¬¦ï¼Œé‡åˆ°åˆ†å·è¡¨ç¤ºè¯¥æ®µè¯­å¥å·²ç»ç»“æŸï¼ŒMySQL å¯ä»¥å¼€å§‹æ‰§è¡Œäº†ã€‚å› æ­¤ï¼Œè§£é‡Šå™¨é‡åˆ°è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œä¸­çš„åˆ†å·åå°±å¼€å§‹æ‰§è¡Œï¼Œç„¶åä¼šæŠ¥é”™ï¼Œå› ä¸ºæ²¡æœ‰æ‰¾åˆ°å’Œ BEGIN åŒ¹é…çš„ ENDã€‚
> 
> è¿™æ—¶å°±ä¼šç”¨åˆ°Â `DELIMITER`Â å‘½ä»¤ï¼ˆDELIMITER æ˜¯å®šç•Œç¬¦ï¼Œåˆ†éš”ç¬¦çš„æ„æ€ï¼‰ã€‚å®ƒæ˜¯ä¸€æ¡å‘½ä»¤ï¼Œä¸éœ€è¦è¯­å¥ç»“æŸæ ‡è¯†ï¼Œè¯­æ³•ä¸ºï¼š`DELIMITER new_delemiter`ã€‚`new_delemiter`Â å¯ä»¥è®¾ä¸º 1 ä¸ªæˆ–å¤šä¸ªé•¿åº¦çš„ç¬¦å·ï¼Œé»˜è®¤çš„æ˜¯åˆ†å·Â `;`ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠå®ƒä¿®æ”¹ä¸ºå…¶ä»–ç¬¦å·ï¼Œå¦‚Â `$`Â -Â `DELIMITER $`Â ã€‚åœ¨è¿™ä¹‹åçš„è¯­å¥ï¼Œä»¥åˆ†å·ç»“æŸï¼Œè§£é‡Šå™¨ä¸ä¼šæœ‰ä»€ä¹ˆååº”ï¼Œåªæœ‰é‡åˆ°äº†Â `$`ï¼Œæ‰è®¤ä¸ºæ˜¯è¯­å¥ç»“æŸã€‚æ³¨æ„ï¼Œä½¿ç”¨å®Œä¹‹åï¼Œæˆ‘ä»¬è¿˜åº”è¯¥è®°å¾—æŠŠå®ƒç»™ä¿®æ”¹å›æ¥ã€‚

**`NEW`Â å’ŒÂ `OLD`**

*   MySQL ä¸­å®šä¹‰äº† NEW å’Œ OLD å…³é”®å­—ï¼Œç”¨æ¥è¡¨ç¤ºè§¦å‘å™¨çš„æ‰€åœ¨è¡¨ä¸­ï¼Œè§¦å‘äº†è§¦å‘å™¨çš„é‚£ä¸€è¡Œæ•°æ®ã€‚

*   åœ¨ INSERT å‹è§¦å‘å™¨ä¸­ï¼ŒNEW ç”¨æ¥è¡¨ç¤ºå°†è¦ï¼ˆBEFOREï¼‰æˆ–å·²ç»ï¼ˆAFTERï¼‰æ’å…¥çš„æ–°æ•°æ®ï¼›

*   åœ¨ UPDATE å‹è§¦å‘å™¨ä¸­ï¼ŒOLD ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»è¢«ä¿®æ”¹çš„åŸæ•°æ®ï¼ŒNEW ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»ä¿®æ”¹ä¸ºçš„æ–°æ•°æ®ï¼›

*   åœ¨ DELETE å‹è§¦å‘å™¨ä¸­ï¼ŒOLD ç”¨æ¥è¡¨ç¤ºå°†è¦æˆ–å·²ç»è¢«åˆ é™¤çš„åŸæ•°æ®ï¼›

*   ä½¿ç”¨æ–¹æ³•ï¼šNEW.columnName ï¼ˆcolumnName ä¸ºç›¸åº”æ•°æ®è¡¨æŸä¸€åˆ—åï¼‰

### åˆ›å»ºè§¦å‘å™¨

> æç¤ºï¼šä¸ºäº†ç†è§£è§¦å‘å™¨çš„è¦ç‚¹ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹åˆ›å»ºè§¦å‘å™¨çš„æŒ‡ä»¤ã€‚

`CREATE TRIGGER`Â æŒ‡ä»¤ç”¨äºåˆ›å»ºè§¦å‘å™¨ã€‚

è¯­æ³•ï¼š

```
CREATE TRIGGER trigger_name
trigger_time
trigger_event
ON table_name
FOR EACH ROW
BEGIN
  trigger_statements
END;
```

è¯´æ˜ï¼š

*   trigger_nameï¼šè§¦å‘å™¨å

*   trigger_time: è§¦å‘å™¨çš„è§¦å‘æ—¶æœºã€‚å–å€¼ä¸º BEFORE æˆ– AFTERã€‚

*   trigger_event: è§¦å‘å™¨çš„ç›‘å¬äº‹ä»¶ã€‚å–å€¼ä¸º INSERTã€UPDATE æˆ– DELETEã€‚

*   table_name: è§¦å‘å™¨çš„ç›‘å¬ç›®æ ‡ã€‚æŒ‡å®šåœ¨å“ªå¼ è¡¨ä¸Šå»ºç«‹è§¦å‘å™¨ã€‚

*   FOR EACH ROW: è¡Œçº§ç›‘è§†ï¼ŒMysql å›ºå®šå†™æ³•ï¼Œå…¶ä»– DBMS ä¸åŒã€‚

*   trigger_statements: è§¦å‘å™¨æ‰§è¡ŒåŠ¨ä½œã€‚æ˜¯ä¸€æ¡æˆ–å¤šæ¡ SQL è¯­å¥çš„åˆ—è¡¨ï¼Œåˆ—è¡¨å†…çš„æ¯æ¡è¯­å¥éƒ½å¿…é¡»ç”¨åˆ†å·Â ;Â æ¥ç»“å°¾ã€‚

ç¤ºä¾‹ï¼š

```
DELIMITER $
CREATE TRIGGER `trigger_insert_user`
AFTER INSERT ON `user`
FOR EACH ROW
BEGIN
    INSERT INTO `user_history`(user_id, operate_type, operate_time)
    VALUES (NEW.id, 'add a user',  now());
END $
DELIMITER ;
```

### æŸ¥çœ‹è§¦å‘å™¨

```
SHOW TRIGGERS;
```

### åˆ é™¤è§¦å‘å™¨

```
DROP TRIGGER IF EXISTS trigger_insert_user;
```

![](https://upload-images.jianshu.io/upload_images/6943526-8252a61ad253cf38.gif?imageMogr2/auto-orient/strip)
