å¾®ä¿¡å°ç¨‹åºæ–‡æ¡£ä¸­æä¾›çš„ç»„ä»¶æœ‰é™ï¼Œä¸€å®šç¨‹åº¦ä¸Šé™åˆ¶äº†å¼€å‘éœ€æ±‚ï¼Œè¿™é‡Œå°±éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ä¸€äº›æ§ä»¶ï¼Œå®ç°å¼€å‘éœ€æ±‚ã€‚
è‡ªå®šä¹‰æ§ä»¶æœ‰ä¸¤ç§æ–¹å¼ï¼Œä¸€ç§æ˜¯é€‰æ‹©æ¨¡æ¿çš„æ–¹å¼ï¼Œå¦ä¸€ç§æ˜¯é€‰æ‹©ç»„ä»¶çš„æ–¹å¼æ¥åˆ›å»ºã€‚è¿™é‡Œæˆ‘é€‰æ‹©äº†ç»„ä»¶æ–¹å¼æ¥åˆ›å»ºï¼Œè¿™æ ·åªéœ€å¼•å…¥ç»„ä»¶å’Œå¤–éƒ¨æ·»åŠ æ•°æ®ï¼Œå†…éƒ¨å±•ç¤ºæ•°æ®ï¼Œå³å¯å®ç°é‡ç”¨ã€‚

![image](https://upload-images.jianshu.io/upload_images/1213330-da47b2ece0252c7c?imageMogr2/auto-orient/strip%7CimageView2/2/w/922/format/webp)

##### 1ã€æ–‡ä»¶ç›®å½•ç»“æ„

è¿™é‡Œä¸€å®šè¦æ³¨æ„æˆ‘ä»¬ç›®å½•ç»“æ„ï¼Œä¸ªäººå–œå¥½æŠŠé¡¹ç›®ä¸­çš„ä¸šåŠ¡æ–‡ä»¶æ”¾åœ¨pagesä¸­ï¼Œå›¾ç‰‡æ”¾åœ¨ä¸pagesåŒçº§çš„imagesæ–‡ä»¶ä¸­ï¼Œç¬¬ä¸‰æ–¹çš„sdkå­˜æ”¾åœ¨libsæ–‡ä»¶ä¸­ï¼Œå·¥å…·ç±»å­˜æ”¾åœ¨utilsæ–‡ä»¶ä¸­ï¼ŒåŒæ ·æŠŠå…±ç”¨çš„è‡ªå®šä¹‰ç»„ä»¶å­˜æ”¾åœ¨åŒçº§çš„componentæ–‡ä»¶ä¸­ã€‚è¿™æ ·ä¾¿äºç®¡ç†ï¼ŒæŸ¥æ‰¾ä½¿ç”¨ã€‚

![image](https://upload-images.jianshu.io/upload_images/1213330-bdf58437629d2c81?imageMogr2/auto-orient/strip%7CimageView2/2/w/376/format/webp)

##### 2ã€è‡ªå®šä¹‰ç»„ä»¶

å¾®ä¿¡å°ç¨‹åºä¸­æ²¡æœ‰selectä¸‹æ‹‰é€‰é¡¹æ¡†ï¼Œè¿™é‡Œé€‰æ‹©ç»„ä»¶çš„æ–¹å¼æ¥è‡ªå®šä¹‰åˆ›å»ºä¸€ä¸ªselectç»„ä»¶ã€‚

åœ¨componentæ–‡ä»¶ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªselectæ–‡ä»¶å¤¹ï¼Œéšåselectæ–‡ä»¶å¤¹ä¸‹æ‰‹åŠ¨åˆ›å»ºï¼šselect.jsã€select.jsonã€select.wxmlã€select.wxss å››ä¸ªæ–‡ä»¶ã€‚(`æ³¨æ„ï¼š`Â å¯ä»¥åœ¨selectæ–‡ä»¶å¤¹ä¸‹è‡ªåŠ¨åˆ›å»ºä¸Šé¢ğŸ‘†å››ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨åˆ›å»ºçš„æ–‡ä»¶ä¼šè‡ªåŠ¨é…ç½®å¥½ä»£ç ã€‚åªéœ€åœ¨å¼•å…¥ç»„ä»¶çš„æ—¶å€™ï¼Œåœ¨å¼•å…¥ç»„ä»¶çš„é¡µé¢çš„jsonæ–‡ä»¶ä¸­é…ç½®ç»„ä»¶çš„åç§°å’Œç»„ä»¶çš„ä½ç½®å³å¯ã€‚)

###### 2.2ã€é…ç½®ç»„ä»¶

select.jsã€select.jsonã€select.wxmlã€select.wxssä¸Šé¢å››ä¸ªæ–‡ä»¶æ˜¯æ˜¯æˆ‘ä»¬æ‰‹åŠ¨åˆ›å»ºçš„ï¼Œé‚£å°±éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨é…ç½®ä»£ç ã€‚åœ¨jsonæ–‡ä»¶ä¸­å†™å…¥ä»£ç ï¼š`"component": true`Â è¡¨ç¤ºè‡ªå®šä¹‰ç»„ä»¶å£°æ˜ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºã€‚

```
{
  "component": true
}

```

**åŒæ—¶ï¼Œjsæ–‡ä»¶ä¸­ä¹Ÿéœ€è¦å†™æˆè¿™ç§æ ¼å¼ï¼Œå…¶ä»£ç å¦‚ä¸‹ï¼š**

```
Component({
  /**
 1\. ç»„ä»¶çš„å±æ€§åˆ—è¡¨
   */
  properties: {
    selectArray: {
      type: Array,
    },
     // åˆå§‹æ—¶è¦å±•ç¤ºçš„å†…å®¹
    currentText:{
      type:String,
    }
  },

  /**
 2\. ç»„ä»¶çš„åˆå§‹æ•°æ®
   */
  data: {
    isShow: false, // åˆå§‹optionä¸æ˜¾ç¤º
    arrowAnimation: {} // ç®­å¤´çš„åŠ¨ç”»
  },

  /**
 3\. ç»„ä»¶çš„æ–¹æ³•åˆ—è¡¨
   */
  methods: {
    //optionçš„æ˜¾ç¤ºä¸å¦
    selectToggleAction: function () {
      // è·å–å½“å‰optionæ˜¾ç¤ºçš„çŠ¶æ€
      var nowShow = this.data.isShow;
      // åˆ›å»ºåŠ¨ç”»
      var animation = wx.createAnimation({
        timingFunction: "ease"
      })
      this.animation = animation;
      if (nowShow) {
        animation.rotate(0).step();
        this.setData({
          arrowAnimation: animation.export()
        })
      } else {
        animation.rotate(180).step();
        this.setData({
          arrowAnimation: animation.export()
        })
      }
      this.setData({
        isShow: !nowShow
      })
    },
    //è®¾ç½®å†…å®¹
    selectItemAction: function (e) {
      // å½“å‰optionçš„æ•°æ®æ˜¯å¼•å…¥ç»„ä»¶çš„é¡µé¢ä¼ è¿‡æ¥çš„ï¼Œæ‰€ä»¥è¿™é‡Œè·å–æ•°æ®åªæœ‰é€šè¿‡this.properties
      var nowData = this.properties.selectArray;
      var index = e.target.dataset.index; // å½“å‰ç‚¹å‡»çš„ç´¢å¼•
      var current_text = nowData[index].name; // å½“å‰ç‚¹å‡»çš„å†…å®¹
      var current_type = nowData[index].type; // å½“å‰ç‚¹å‡»çš„å†…å®¹
      // å†æ¬¡æ‰§è¡ŒåŠ¨ç”»ï¼Œæ³¨æ„è¿™é‡Œä¸€å®šæ˜¯this.animationæ¥ä½¿ç”¨åŠ¨ç”»!!!!!!
      this.animation.rotate(0).step();
      this.setData({
        isShow: false,
        current_text: current_text,
        arrowAnimation: this.animation.export()
      })
      // å†…å®¹æ›´æ–°åï¼Œéœ€è¦æŠŠæ›´æ–°çš„æ•°æ®ä¼ è¾“å‡ºå»
      var nowDate = {
        id: index,
        name: current_text,
        type: current_type
      }
      // è¿™é‡Œçš„ getNowData è¦å’Œå¤–éƒ¨çš„ bind:getNowData ï¼Œåç§°ä¸€å®šè¦å¯¹åº”
      this.triggerEvent('getNowData', nowDate);
      console.log("é€‰æ‹©ä¹‹åçš„current_text", current_text);
    }
  }
})

```

1.  Componentæ„é€ å™¨å¯ç”¨äºå®šä¹‰ç»„ä»¶ï¼Œè°ƒç”¨Componentæ„é€ å™¨æ—¶å¯ä»¥æŒ‡å®šç»„ä»¶çš„å±æ€§ã€æ•°æ®ã€æ–¹æ³•ç­‰ã€‚
2.  propertiesæ˜¯ç»„ä»¶çš„å¯¹å¤–å±æ€§ï¼Œæ˜¯å±æ€§ååˆ°å±æ€§è®¾ç½®çš„æ˜ å°„è¡¨ï¼Œå±æ€§è®¾ç½®ä¸­å¯åŒ…å«ä¸‰ä¸ªå­—æ®µï¼Œ type è¡¨ç¤ºå±æ€§ç±»å‹ã€ value è¡¨ç¤ºå±æ€§åˆå§‹å€¼ã€ observer è¡¨ç¤ºå±æ€§å€¼è¢«æ›´æ”¹æ—¶çš„å“åº”å‡½æ•°ã€‚
3.  data å’Œæ™®é€šé¡µé¢çš„dataä¸€æ ·ï¼Œæ˜¯ç»„ä»¶çš„å†…éƒ¨æ•°æ®ï¼Œå’Œ properties ä¸€åŒç”¨äºç»„ä»¶çš„æ¨¡ç‰ˆæ¸²æŸ“ã€‚
4.  methodsç»„ä»¶çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬äº‹ä»¶å“åº”å‡½æ•°å’Œä»»æ„çš„è‡ªå®šä¹‰æ–¹æ³•ï¼Œå…³äºäº‹ä»¶å“åº”å‡½æ•°çš„ä½¿ç”¨ã€‚åœ¨è¿™é‡Œé¢è·å–æ•°æ®æœ‰ä¸¤ç§æ–¹æ³•ï¼šä¸€ç§æ˜¯è·å–dataé‡Œçš„æ•°æ®ï¼š this.data.å±æ€§åï¼›ä¸€ç§æ˜¯è·å– properties ä¸­çš„å±æ€§å€¼ï¼š this.properties.å±æ€§åã€‚

`æ³¨æ„ï¼ï¼ï¼`
å¦‚æœè¿˜éœ€è¦å…¶ä»–å±æ€§ã€æ•°æ®ã€æ–¹æ³•ç­‰å¯æŸ¥çœ‹å¾®ä¿¡å°ç¨‹åºå®˜æ–¹æ–‡æ¡£Â [Componentæ„é€ å™¨](https://links.jianshu.com/go?to=https%3A%2F%2Fdevelopers.weixin.qq.com%2Fminiprogram%2Fdev%2Fframework%2Fcustom-component%2Fcomponent.html)ã€‚

**åœ¨wxmlæ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š**

```
<view class='section-select-box'>
  <view class='select-content' bindtap='selectToggleAction'>
    <view class='select-text'>{{currentText}}</view>
    <image class='select-img' src='../../images/icon_arrow_down.png' animation="{{arrowAnimation}}"></image>
  </view>

  <view class='select-list' wx:if="{{isShow}}">
      <view class='select-list-item' wx:for="{{selectArray}}" data-index="{{index}}" wx:key='{{index}}' bindtap='selectItemAction'>{{item.name}}</view>
  </view>
</view>

```

1.  animationæ–¹æ³•æ˜¯ä¸ºäº†è·å–å½“å‰ç‚¹å‡»å…ƒç´ çš„ç´¢å¼•ä¸å†…å®¹ã€‚è¿™é‡ŒÂ `animation="{{arrowAnimation}}"`æ˜¯ç®­å¤´è½¬åŠ¨çš„åŠ¨ç”»æ•ˆæœã€‚
2.  `bindtap='selectToggleAction'`Â selectToggleAction æ–¹æ³•æ˜¯æ§åˆ¶ä¸‹æ‹‰é€‰é¡¹æ¡†éšè—å’Œæ˜¾ç¤ºçš„äº‹ä»¶ã€‚
3.  `bindtap='selectItemAction'`Â selectItemAction æ˜¯ä¸‹æ‹‰é€‰é¡¹æ¡†é€‰æ‹©å­é¡¹ä¹‹åï¼Œè®¾ç½®å†…å®¹çš„äº‹ä»¶ã€‚
4.  `wx:if="{{isShow}}"`Â isShowæ˜¯ä¸ºäº†æ§åˆ¶ option é€‰é¡¹æ˜¾ç¤ºä¸éšè—ã€‚

**åœ¨wxssæ–‡ä»¶ä¸­ï¼Œä»£ç å¦‚ä¸‹æ‰€ç¤ºï¼š**

```
.section-select-box {
  margin: 20rpx 30rpx;
  width: 690rpx;
}

.select-content {
  border: 2rpx solid #e2e2e2;
  border-radius: 10rpx;
  background: white;
  font-size: 34rpx;
  position: relative;
  height: 80rpx;
  line-height: 80rpx;
  padding: 0 10px;
}

.select-text {
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 32rpx;
}

.select-img {
  position: absolute;
  right: 30rpx;
  top: 10rpx;
  width: 60rpx;
  height: 60rpx;
  transition: all .3s ease;
}

.select-list {
  background: white;
  width: inherit;
  position: absolute;
  border: 2rpx solid #e2e2e2;
  border-top: none;
  box-sizing: border-box;
  z-index: 3;
  max-height: 160rpx;
  overflow: auto;
}

.select-list-item {
  height: 30px;
  line-height: 30px;
  border-top: 2rpx solid #e2e2e2;
  padding: 0 10px;
  text-align: left;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
  font-size: 14px;
}

.select-list-item:first-child{
  border-top: none;
}

```

###### 2.3ã€ä½¿ç”¨ç»„ä»¶

1.  ä½¿ç”¨è‡ªå®šä¹‰ç»„ä»¶å‰ï¼Œéœ€è¦åœ¨å¼•å…¥ç»„ä»¶çš„é¡µé¢çš„jsonæ–‡ä»¶ä¸­é…ç½®ï¼Œæ¯”å¦‚æˆ‘è¦åœ¨ index.wxml ä¸­å¼•å…¥ï¼Œé‚£ä¹ˆåœ¨ index.json ä¸­æˆ‘å°±éœ€è¦é…ç½®ï¼š

```
{
  "usingComponents": {
    "Select": "/component/select/select"
  }
}

```

`æ³¨æ„äº‹é¡¹:`
Select æ˜¯ä½ å®šä¹‰çš„ç»„ä»¶çš„åç§°ï¼Œåé¢çš„æ˜¯ç»„ä»¶æ‰€åœ¨çš„ä½ç½®ã€‚Â `/`Â å•æ–œæ è¡¨ç¤ºæ ¹ç›®å½•ï¼Œæ˜¯ç»å¯¹è·¯å¾„ã€‚

å¦‚æœæ§åˆ¶å°æŠ¥é”™ï¼Œå‡ºç°æ²¡æ‰¾åˆ°è·¯å¾„çš„æƒ…å†µï¼Œä¸€å®šæ˜¯è‡ªå·±å¡«å†™çš„è·¯å¾„ä¸å¯¹ï¼Œè®¤çœŸæ£€æŸ¥è·¯å¾„ä»£ç ã€‚

![image](https://upload-images.jianshu.io/upload_images/1213330-25d55780080c3225.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/777/format/webp)

é…ç½®å¥½åï¼Œåœ¨wxmlå¼•å…¥ç»„ä»¶ï¼Œä»£ç å¦‚ä¸‹ï¼š


```  
<Select 
  class="section-select" 
  select-array='{{selectArray}}'  
  current-text="{{current_text}}" 
  bind:getNowData='getCurrentTextAction'>
</Select>
```

1.  select-array æ˜¯æˆ‘åœ¨ç»„ä»¶ä¸­è‡ªå®šä¹‰çš„å±æ€§åï¼Œè¿™ä¸ªæ˜¯å’Œç»„ä»¶æ‰€åœ¨çš„ js ä¸­propertiesä¸­çš„å±æ€§æ˜¯å¯¹åº”çš„ã€‚åœ¨ properties å®šä¹‰çš„å±æ€§ä¸­ï¼Œå±æ€§åé‡‡ç”¨é©¼å³°å†™æ³•`ä¾‹å¦‚ï¼šselectArray`ã€‚åœ¨å¼•å…¥ç»„ä»¶çš„ wxml ä¸­ï¼ŒæŒ‡å®šå±æ€§å€¼æ—¶åˆ™å¯¹åº”ä½¿ç”¨è¿å­—ç¬¦å†™æ³•`ä¾‹å¦‚ï¼šselect-array='{{selectArray}}ï¼ŒselectArrayä¸ºselectç»„ä»¶ä¸­æ‰€éœ€å±•ç¤ºçš„æ•°æ®æº`ã€‚
2.  è¿™é‡ŒgetNowDataæ˜¯è‡ªå®šä¹‰çš„å­ç»„ä»¶éœ€è¦è§¦å‘çš„äº‹ä»¶åï¼ŒgetNowDataæ˜¯å¼•å…¥ç»„ä»¶çš„é¡µé¢éœ€è¦è·å–ä¼ è¿‡æ¥çš„æ•°æ®çš„è‡ªå®šä¹‰çš„äº‹ä»¶åã€‚

```
      // å†…å®¹æ›´æ–°åï¼Œéœ€è¦æŠŠæ›´æ–°çš„æ•°æ®ä¼ è¾“å‡ºå»
      var nowDate = {
        id: index,
        name: current_text,
        type: current_type
      }
      // è¿™é‡Œçš„ getNowData è¦å’Œå¤–éƒ¨çš„ bind:getNowData ï¼Œåç§°ä¸€å®šè¦å¯¹åº”
      this.triggerEvent('getNowData', nowDate);
      console.log("é€‰æ‹©ä¹‹åçš„current_text", current_text);
```

åœ¨å¼•å…¥ç»„ä»¶çš„é¡µé¢çš„jsæ·»åŠ å¼•å…¥ç»„ä»¶æ—¶ï¼Œè‡ªå®šä¹‰çš„å‡½æ•°ï¼š

```
  getCurrentTextAction:function(e){
    let item = e.detail;
    this.setData({
      current_text: item.name, 
      current_type: item.type
    });
  }
```
console.log("æ‰“å°æ•°æ®",e.detail)ï¼Œä¼ è¿‡æ¥çš„å€¼å°±åœ¨detailé‡Œé¢ã€‚

### ç»“è¯­

å¾®ä¿¡å°ç¨‹åºä¸­è‡ªå®šä¹‰ç»„ä»¶çš„ç”¨æ³•è¿˜æœ‰å¾ˆå¤š,æ¯”å¦‚ç»„ä»¶ç”Ÿå‘½å‘¨æœŸ,äº‹ä»¶ç­‰ç­‰,æ›´å¤šçš„å†…å®¹å¯ä»¥å‚è€ƒ[å®˜æ–¹æ–‡æ¡£](https://link.jianshu.com/?t=https://mp.weixin.qq.com/debug/wxadoc/dev/framework/custom-component/).

